const allWorks = new Set()
const allCategories = new Set()


const projectGal = document.querySelector(".gallery");
const portfolio = document.querySelector("#portfolio");
const filterContainer = document.querySelector("#filterBtnContainer");

async function init(){
    const works = await fetchDatabaseData("works")
    for (const work of works) {
        allWorks.add(work)
    }
    const categories = await fetchDatabaseData("categories")
    for (const categorie of categories) {
        allCategories.add(categorie)
    }
    genProGal()
    createFilter()
   
    
}
init()

// get works form api and make gallery be generated by javascript automaticly
async function fetchDatabaseData(type) {
    try {
        const response = await fetch(`http://localhost:5678/api/${type}`);
        return response.json()
    } catch (error) {
        console.error('Erreur lors de la récupération des données depuis l\'API:', error);
    }
}


// creation of the elements of the gallery 
function genProGal(filtre = "0"){
    projectGal.innerHTML = ""
    const fragment = document.createDocumentFragment()
    let selectedWorks = allWorks

    if (filtre !== "0") {
        //selectedWorks = [...allWorks].filter()
    }
    for (const work of selectedWorks){
        // we build the <figure> frist
        const project = document.createElement('figure');
        project.innerHTML = `<img src="${work.imageUrl}" alt="${work.title}">
                            <figcaption>${work.title}</figcaption>`
        //now we appenchild the figure to the main gallery div
        fragment.appendChild(project);
    }
    projectGal.appendChild(fragment)
}

function createFilter(){
    const categoryAll = {id:"0", name : "Tous"};
    allCategories.add(categoryAll);
    const sortedArray = Array.from(allCategories).sort((a, b) => a.id - b.id);
    const sortedAllCategories = new Set(sortedArray);
    const filterButtonsData = [...sortedAllCategories];
    

    filterButtonsData.forEach(buttonData => {
        const button = document.createElement("button");
        button.id = buttonData.id;
        button.textContent = buttonData.name;
        button.setAttribute("class", "filterBtn");
        filterContainer.appendChild(button);
    });

    return filterContainer;
}

